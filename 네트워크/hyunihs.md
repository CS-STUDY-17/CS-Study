# 네트워크
## 네트워크의 기초
> 네트워크란 노드와 링크가 연결되어 있으며 리소스를 공유하는 집합이다
- 노드: 서버, 라우터, 스위치 등
- 링크: 유선 or 무선
### 처리량과 지연 시간
- 처리량(throughput)
  -  링크 내에서 성공적으로 전달된 데이터의 양 
  - bps(bits per second)
- 대역폭(bandwidth)
  - 주어진 시간 동안 네트워크 연결을 통해 흐를 수 있는 최대 비트 수
<p>
<img src ="https://github.com/CS-STUDY-17/CS-Study/assets/86969518/a9f4a72a-fed6-42a4-8334-2e3927b224e4" width="40%">
<img src="https://github.com/CS-STUDY-17/CS-Study/assets/86969518/3864e149-e432-4486-9166-26a4b032ba07" width="40%">
</p>

- 지연 시간(latency)
  - 어떤 메시지가 두 장치 사이를 왕복하는데 걸린 시간 (요청이 처리되는 시간)

### 네트워크 토폴로지와 병목 현상
#### 네트워크 토폴로지
> 네트워크 토폴로지(network topology)는 노드와 링크가 어떻게 배치되어 있는지에 대한 방식이자 연결 형태
- 트리 토폴로지 (tree topology)
  - 계층형 토폴로지
  - +) 노드의 추가, 삭제가 쉬움
  - -) 특정 노드에 트래픽이 집중될 때 하위 노드에 영향 가능
- 버스 토폴로지 (bus topology)
  - 중앙 통신 회선 하나에 여러 개의 노드 연결되어 공유
  - 근거리 통신망(LAN)에서 사용됨
  - +) 설치 비용 적음
  - +) 신뢰성 우수
  - +) 노드 추가 삭제 쉬움
  - -) **스푸핑**
  > 스푸핑이란 스위칭 기능을 마비시키거나 속여서 패킷을 수신부 대신 악의적인 노드에 전달하게 하는 것
- 스타 토폴로지 (start topology)
  - +) 노드 추가 쉬움
  - +) 에러 탐지 쉬움 (어떠한 노드에 장애가 발생해도), 장애 노드가 중앙 노드가 아닐 경우 다른 노드에 영향 적게 끼침
  - +) 패킷 충돌 가능성 적음
  - -) 중앙 노드에 장애 발생 시 전체 네트워크 사용 불가
  - -) 설치 비용 비쌈
- 링형 토폴로지 (ring topology)
  - 하나의 연속된 길을 통해 통신
  - +) 노드 수 증가해도 네트워크 상 손실 거의 없음
  - +) 충돌 발생 가능성 적음
  - +) 노드의 고장 발견을 쉽게 찾을 수 있음
  - -) 네트워크 구성 변경 어려움
  - -) 회선에 장애 발생 시 전체 네트워크에 영향
- 메시 토폴로지 (mesh topology)
  - +) 한 단말 장치에 장애 발생해도 여러 개 경로 존재하므로 네트워크 계속 사용 가능
  - +) 트래픽 분산 처리 가능
  - -) 노드 추가 어려움
  - -) 구축 비용과 운용 비용 비쌈

![network-topology-types-diagram](https://github.com/CS-STUDY-17/CS-Study/assets/86969518/02532022-b88e-47c7-afdb-bf07a45db311)


#### 병목(bottleneck) 현상
> 시스템의 CPU나 메모리, 디스크 등 자원 중 하나가 다른 자원들에 비해 처리 속도가 느려서, 전체적인 성능을 제한하는 경우

네트워크 토폴로지가 중요한 이유:   
병목 현상을 찾을 때 중요한 기준이 된다.  
네트워크의 토폴로지와 경로를 알아야 병목 현상을 올바르게 해결할 수 있다 

해결:
- Throughput 개선
- Latency 개선
- 회선 추가 (토폴로지에 맞게)

### 네트워크 분류
| 종류                | 범위                | 전송 속도       | 혼잡도       |
|-------------------|---------------------|-----------------|--------------|
| LAN (근거리 통신망)     | 같은 건물, 캠퍼스 내 | 빠름            | 낮음         |
| MAN (대도시 지역 네트워크) | 도시                | 중간            | 중간         |
| WAN (광역 네트워크)     | 국가 또는 대륙       | 낮음            | 높음         |

### 네트워크 성능 분석 명령어
- ping [ ip 주소 or 도메인 주소 ]
  - 대상 노드를 향해 일정 크기의 패킷 전송
  - 노드의 패킷 수신 상태, 도달하기까지 시간, 해당 노드까지 네트워크 잘 연결되어 있나 확인
  - ICMP 프로토콜을 통해 동작
  
  
<img width="462" alt="스크린샷 2023-10-12 오후 3 30 50" src="https://github.com/CS-STUDY-17/CS-Study/assets/86969518/cd73ab2c-2112-477b-ae71-344159bcb301">

- netstat
  - 접속되어 있는 서비스들의 네트워크 상태 표시
  - 네트워크 접속, 라우팅 테이블, 네트워크 프로토콜 리스트
  - 주로 서비스의 포트가 열려있나 확인할 때 사용

<img width="559" alt="스크린샷 2023-10-12 오후 3 33 15" src="https://github.com/CS-STUDY-17/CS-Study/assets/86969518/cd7bd3bc-a3cc-4bfb-8af3-9fd5fdb06752">

- nslookup
  - DNS 관련 확인 (도메인에 매핑된 ip 확인)

<img width="368" alt="스크린샷 2023-10-12 오후 3 34 36" src="https://github.com/CS-STUDY-17/CS-Study/assets/86969518/86076e1c-591b-46c4-b935-481ad7ea9e91">

- tracert / traceroute (윈도우/리눅스) [ ip 주소 or 도메인 주소 ]
  - 목적지 노드까지 네트워크 경로
  - 어느 구간에서 응답 시간이 느려지는지 등 확인 가능

<img width="555" alt="스크린샷 2023-10-12 오후 3 36 21" src="https://github.com/CS-STUDY-17/CS-Study/assets/86969518/6345a5d0-729f-408f-bc91-776e3ecad104">

### 네트워크 프로토콜 표준화
> 네트워크 프로토콜이란 다른 장치들끼리 데이터를 주고받기 위해 설정된 공통된 인터페이스를 말합니다
- IEEE, IETF 등의 표준화 단체에서 정의
- IEEE802.3: 유선 LAN 프로토콜 (Ethernet)
- IEEE802.11: 무선 LAN 프로토콜 (Wireless Network)

## TCP/IP 4계층 모델
인터넷 프로토콜 스위트(internet protocol suite)는 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는
프로토콜의 집합  
주로 TCP/IP 4계층 모델 또는 OSI 7계층 모델로 설명한다

### 계층 구조
- OSI 7계층과 비교

![계층 구조](https://github.com/CS-STUDY-17/CS-Study/assets/86969518/079d6b14-d8ce-4939-b81e-baf0b61b7dea)

- 이 계층들은 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 설계됨

#### 애플리케이션(application) 계층
- 응용프로그램이 사용되는 프로토콜 계층
- 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공함
- 응용프로그램 예시
  - FTP: 파일 전송 표준 통신 프로토콜
  - SSH: 암호화 네트워크 프로토콜
  - HTTP: World Wide Web을 위한 데이터 통신의 기초이자 웹 사이트를 이용하는 데 쓰는 프로토콜
  - SMTP: 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
  - DNS: 도메인 이름과 ip 주소를 매칭해주는 서버, 이를 통해 ip 주소가 바뀌어도 같은 도메인 주소로 서비스 가능
    - ex) www.naver.com 에 DNS 쿼리 오면:
    - [Root DNS] -> [.com DNS] -> [.naver DNS] -> [.www DNS] (완벽한 주소 찾아 ip 매핑)

#### 전송(transport) 계층
- 송신자와 수신자 연결하는 통신 서비스 제공
- 어플리케이션과 인터넷 계층 사이의 데이터 전달될 때 중계 역할
- TCP, UDP

#### TCP

- 가상회선 패킷 교환 방식 (Virtual Circuit Packet Switching)
  - 각 패킷에 가상회선 식별ㄹ자 포함
  - 모든 패킷 전송시 가상회선 해제
  - 패킷은 전송 순서대로 도착
  - 이전에 있던 Circuit Switching, Packet Switching의 단점을 보완해 나옴
- 패킷 사이 순서 보장
- 연결 지향 프로토콜 사용해 연결 (신뢰성)
- 수신 여부 확인
- 패킷 전송 보장되어야 하는 웹서버 등에서 이용

<br>

#### TCP 연결 성립
- 3-way handshake → 신뢰성 구축 → 데이터 전송 시작
- TCP는 이 과정이 있어서 신뢰성 있는 계층
- UDP는 이 과정이 없어서 신뢰성 없는 계층

![3wayhandshake](https://github.com/CS-STUDY-17/CS-Study/assets/86969518/72ae6b9f-b71d-4d0b-af29-3c1225f44340)

1. SYN: 클라이언트의 ISN을 담아 서버에 SYN을 보냄  
  ISN은 새로운 TCP 연결의 첫번째 패킷에 할당된 임의의 시퀀스 번호 (장치마다 다를 수 있음)
2. SYN + ACK: 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며 승인번호로 클라이언트의 ISN + 1 을 보냄
3. ACK: 클라이언트는 서버의 ISN + 1 한 값인 승인번호를 담아 서버에 ACK을 보냄

#### TCP 연결 해제 과정
- 4-way handshake

![99229C485C1D90C038](https://github.com/CS-STUDY-17/CS-Study/assets/86969518/77f654be-d517-4c83-a576-32e26e13e68d)

> TIME_WAIT: 그냥 연결을 닫으면 되지 왜 굳이 일정 시간 뒤에 닫을까?  
> ** 소켓이 소멸되지 않고 일정 시간 유지되는 상태, OS마다 유지 시간 좀 다름
1. 지연 패킷이 발생할 경우 대비
   - 패킷이 뒤늦게 도달하고 이를 처리하지 못한다면 데이터 무결성 문제가 발생 (전체가 아니라 일부 데이터만 들어오는 현상)
2. 두 장치가 연결이 닫혔는지 확인
   - LASK_ACK 상태에서 닫히게 되면 다시 새로운 뎐결을 하려고 할 때 장치는 줄곧 LASK_ACK으로 되어 있기 떄문에 접속 오류가 날 것

#### UDP
- 데이터그램 패킷 교환 방식
  - 패킷이 독립적으로 이동하며 최적의 경로를 선택
  - 하나의 메시지에서 분할된 여러 패킷이 서로 다른 경로로 전송될 수 있음
- 순서 보장 X
- 수신 여부 확인 X
- 오디오 통신 등에서 사용

#### 인터넷(internet) 계층
- 장치로부터 받은 네트워크 패킷을 ip 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
- IP, ARP, ICMP 등
- 패킷을 수신해야 할 상대의 주소를 지정해 데이터 전달
- 상대가 제대로 받았는지에 대해는 보장 X (비연결형적 특징)

#### 링크(link) 계층 (네트워크 접근 계층)
- 전선, 광섬유, 무선 등 실질적으로 데이터 전달하고 장치 간에 신호를 주고받는 '규칙'을 정하는 계층
- 물리계층: 무선 LAN, 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
- 데이터 링크 계층: '이더넷 프레임'을 통해 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층

#### 유선 LAN (IEEE802.3)
- 전이중화(full duplex) 통신
  - 양쪽 장치가 동시에 송수신할 수 있는 방식 (송신로 수신로 나눠서 데이터 주고받음)
  - 현대의 고속 이더넷은 이 방식을 기반으로 통신
- CSMA/CD
  - 반이중화 통신, 이전에 유선 LAN에 쓰던 방식
  - 데이터를 <b>보낸 이후</b> 충돌이 발생한다면 일정 시간 이휴 재전송 (Carrier Sense Multiple Access with Collision Detection)
  - 송신로 수신로 나누어지지 않고 한 경로 기반으로 데이터 보냄 (보낼 때 충돌에 대비해야)
- 유선 LAN 이루는 케이블: 트위스트 페어(TP) 케이블, 광섬유 케이블
  - 트위스트 페어 케이블
    - 하나의 케이블처럼 보이지만 실제로는 8개의 구리선 두개씩 꼬아서 묶음
    - 구리선을 실드 처리하지 않고 덮은 UTP 케이블과 실드 처리하고 덮은 STP로 나누어짐 (우리가 많이 보는 케이블은 UTP 케이블로 LAN 케이블이라고 흔히 말함)
  - 광섬유 케이블
    - 레이저 이용해 통신하기 때문에 구리선과는 비교할 수 없을 만큼 장거리 및 고속 통신이 가능 (보통 100Gbps)
    - 광섬유 내부와 외부를 다른 밀도 가지는 유리나 플라스틱 섬유로 제작 → 한번 들어간 빛이 내부에서 계속적으로 반사
    - 빛의 굴절율이 높은 부분: core, 빛의 굴절율이 낮은 부분: cladding
    
    ![image-2](https://github.com/CS-STUDY-17/CS-Study/assets/86969518/5d853ff3-373a-4b78-a121-8d41945441ee)

#### 무선 LAN (IEEE802.11)
수신과 송신에 같은 채널 사용함 → 반이중화 통신
- 반이중화(half duplex) 통신
  - 양쪽 장치는 서로 통신할 수 있지만, 동시에 통신 X, 한 번에 한 방향만 통신 가능
  - 데이터 수신 중이면 전송 제한됨
  - 동시에 전송하면 충돌이 발생해 메시지가 손실되거나 왜곡될 수 있어서 충돌 방지 시스템 필요
- CSMA/CA
  - 반이중화 통신 중 하나
  - 데이터 보내기 전 캐리어 감지 등으로 사전에 가능한 한 충돌을 방지하는 방식
  - 과정
    1. 데이터 송신하기 전 무선 매체 살핌
    2. 캐리어 감지: 회선 비어있는지 판단
    3. IFS(Inter FrameSpace): 랜덤 값 기반으로 정해진 시간만큼 기다리며, 만약 무선 매체가 사용 중이면 점차 그 간격 늘려가며 기다림
    4. 이후 데이터 송신
- 무선 LAN 이루는 주파수: 2.4GHz, 5GHz 중 하나
  - 2.4GHz: 장애물에 강하지만 전파 간섭 일어나는 경우 많음
  - 5GHz: 사용할 수 있는 채널 수 많고 동시에 사용 가능, 상대적으로 깨끗한 전파 환경
  - 그래서 보통은 5GHz 쓰는게 좋음
  
  <br>

  - 와이파이
    - 전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술
    - 무선 접속 장치 (AP, Access Point)가 필요 = 공유기
      - 이를 통해 유선 LAN에 흐르는 신호를 무선 LAN 신호로 바꿔줌
    - 와이파이 이외에 무선 LAN 이용한 기술로는 지그비, 블루투스 등이 있다.
  - BSS(Basic Service Set)
    - 기본 서비스 집합
    - 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내에 있는 AP 들과 장치들이 서로 통신이 가능한 구조
    - 근거리 무선 통신
    - 하나의 AP만을 기반으로 구축 → 사용자가 이동하며 네트워크에 접속하는 것은 불가능
  - ESS(Extended Service Set)
    - 하나 이상의 연결된 BSS 그룹
    - 장거리 무선 통신
    - 더 많은 가용성과 이동성 지원 (사용자 이동 가능)

<br>

- 이더넷 프레임
  - 데이터 링크 계층은 이더넷 프레임을 통해 전달받은 데이터의 에러를 검출하고 캡슐화함

![2965_1](https://github.com/CS-STUDY-17/CS-Study/assets/86969518/c62fd5b8-9108-448a-b2a7-300108ecd60f)

1. Preamble: 이더넷 프레임이 시작임을 알림
2. SFD(Start Frame Delimiter): 다음 바이트부터 MAC 주소 필드가 시작됨을 알림
3. DMAC, SMAC (DA, SA): 수신, 송신 MAC 주소
4. EtherType: 데이터 계층 위의 계층인 ip 프로토콜을 정의 (ex: ipv4, ipv6)
5. Payload(Data + Padding): 전달받은 데이터
6. CRC(FCS, Frame Check Sequence): 에러 확인 비트

** MAC 주소: 컴퓨터나 노트북 등 각 장치에는 네트워크에 연결하기 위한 장치(LAN 카드)가 있는데, 이를 구별하기 위한 식별번호. 6바이트(48비트)로 구성

#### 계층 간 데이터 송수신 과정
캡슐화 → 링크 게층 통해 해당 서버와 통신 → 비캡슐화 
![image](https://github.com/CS-STUDY-17/CS-Study/assets/86969518/e2b8c42f-029d-4cb1-83ab-46e7721629c9)

캡슐화 과정: 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정  
각 계층마다 캡슐화 결과 부르는 명칭이 다름 (바로 뒤 PDU 참고)
![image-3](https://github.com/CS-STUDY-17/CS-Study/assets/86969518/c0d7da7c-36f5-4bf7-8e4c-ebe20c8fc137)

비캡슐화 과정: 캡슐화 과정의 반대, 하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정
### PDU
> 네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위를 의미 (Protocol Data Unit)
- 제어 관련 정보 포함된 <b>헤더</b>, 데이터를 의미하는 <b>페이로드</b>로 구성됨
- 각 계층마다 부르는 명칭이 다름

| 계층                  | PDU                       |
|---------------------|---------------------------|
| 애플리케이션(application) | 메시지, 데이터                  |
| 전송(transport)       | 세그먼트(TCP), 데이터그램(UDP)     |
| 인터넷(internet)       | 패킷                        |
| 링크(link)            | 프레임(데이터 링크 계층), 비트(물리 계층) |

> 참고로 PDU 중 아래 계층인 비트로 송수신하는 것이 모든 PDU 중 가장 빠르고 효율적이다   
> 하지만 애플리케이션 계층에서는 문자열을 기반으로 송수신을 하는데, 그 이유는 헤더에 authorization 값 등 다른 값들 넣는 확장이 쉽기 때문